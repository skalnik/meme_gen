express = require 'express'
routes = require '../app'

app = express.createServer();

app.configure ->
  app.use express.logger()
  app.use express.bodyParser()
  app.use express.methodOverride()
  app.use app.router

app.configure 'development', ->
  app.use express.errorHandler({ dumpExceptions: true, showStack: true })

app.configure 'production', ->
  app.use express.errorHandler()

argv = []
options = {}
for arg in process.argv
  if arg.substr(0, 2) == '--'
    parts = arg.split '='
    options[parts[0].substr(2).replace('-','_')] = parts[1] || true
  else
    argv.push arg

require('../app').actions app, argv, options
port = options.port || 3000

console.log "meme_gen server listening on port %d in %s mode", port, app.settings.env
app.listen port
